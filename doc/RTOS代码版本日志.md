> 粗略地记录下这套RTOS版的哨兵代码经历过的大改动

---

#### 2021.1.24  

上下云台的遥控器接收代码改成了双缓冲模式的，应该能够得到性能上的提高；

上下云台代码 对 FreeRTOS 可以控制的中断优先级进行了修改（目前是抢占优先级在 ***2~15*** 之间的中断可以受RTOS控制，即可以调RTOS的API）；

上下云台代码 设置全局的 NVIC 为 **Group4** 模式，即_用来标识中断优先级的4bit全部用作抢占优先级（即主优先级）_；



已发现的bug： 遥控器开着的时间如果太久的话，可能会读不到遥控器的数据了 （可能已解决，通过在空闲中断里重启DMA解决 2021.1.31）

---

#### 2021.1.25

下云台的两轴限幅改为每次进任务都会执行一次，而不是只在上电时进行一次（这样有时会出问题）

---

#### 2021.1.31

上云台的两轴偏置值目前设置成用转子机械角度换算为角度制角度设定的；

上云台yaw轴限幅，因为只能转动从正中间往两边分的一个扇形，故用正中间的机械角度加减某个角度值来限幅；区别于下云台的yaw轴限幅，用当前角度加减某个角度值，用来限制旋转的速度

---

#### 2021.2.9

给三块板添加了cpu占用率检测的任务（类似任务管理器），其中上、下云台用TIM5监测、UART4发送信息；底盘用TIM5监测、USART1发送信息。

把上云台和底盘板之间的CAN遥控器通信写通了。

---

#### 2021.3.3

给三块板添加了独立看门狗，方便调试吧大概

---

#### 2021.3.6

底盘板代码移植了一份F405板子的，引脚定义全部没有改

---

#### 2021.3.7

和邢增宝一起把裁判系统的接收和发送重写了一份库，目前还不算完整，而且还没经过测试

---

#### 2021.3.8

把裁判系统库按照当前今年版本的《2020年裁判系统串口协议附录 V1.1.pdf》改动了一些接口，其中和飞镖、ICRA相关的函数接口目前还没有写实现

通过裁判系统往客户端和其他机器人发送数据的接口目前也没有实现

---

#### 2021.3.13

确认了底盘的光电开关可以工作了，裁判系统的读取也没大问题（但并没有把所有接收函数都测试到）；

但编码器貌似有问题，然后INA也读不出来功率了这次。

---

#### 2021.3.20

用F105的底盘板读出了INA260的电压，电流还不能确定有没有问题；

但用F405的底盘板依然读不出来，考虑把巡逻的代码放到F105上来了



---

TODO:  把所有硬件层的配置，换成从头文件用宏定义来配置各个外设，这样以后如果要换外设的话（比如换成TIM4做delay而不是TIM2做delay），可以只改作为硬件层和应用层接口的那个头文件（看以后有没有机会改这个）（但另一方面，这样做不一定好）